(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-02730f6e"],{"16e7":function(e,t,r){"use strict";r.d(t,"g",function(){return s}),r.d(t,"e",function(){return c}),r.d(t,"c",function(){return o}),r.d(t,"a",function(){return u}),r.d(t,"b",function(){return l}),r.d(t,"d",function(){return f}),r.d(t,"h",function(){return h}),r.d(t,"i",function(){return p}),r.d(t,"f",function(){return m});r("386d");var n=r("bc3a"),i=r.n(n),a=r("da71"),s=function(e){return i.a.get("".concat(a["a"],"/groups/13/projects/?private_token=RfRyfGXCnwJF62boNdKg&order_by=updated_at"),{params:e})},c=function(e){return i.a.get("".concat(a["a"],"/projects/").concat(e.projectId,"/repository/branches/?private_token=RfRyfGXCnwJF62boNdKg&per_page=50"),{params:e})},o=function(e){return i.a.post("".concat(a["a"],"/projects/").concat(e.projectId,"/merge_requests/?private_token=RfRyfGXCnwJF62boNdKg"),e)},u=function(e){return i.a.put("".concat(a["a"],"/projects/").concat(e.projectId,"/merge_requests/").concat(e.mrId,"/merge/?private_token=RfRyfGXCnwJF62boNdKg"),e)},l=function(e){return i.a.put("".concat(a["a"],"/projects/").concat(e.projectId,"/merge_requests/").concat(e.mrId,"/?private_token=RfRyfGXCnwJF62boNdKg&state_event=close"),e)},f=function(e){return i.a.post("".concat(a["a"],"/projects/").concat(e.projectId,"/repository/tags/?private_token=RfRyfGXCnwJF62boNdKg"),e)},h=function(e){return i.a.get("".concat(a["a"],"/projects/").concat(e.projectId,"/repository/tags/?private_token=RfRyfGXCnwJF62boNdKg"))},p=function(e){return i.a.delete("".concat(a["a"],"/projects/").concat(e.projectId,"/repository/tags/").concat(e.tagName,"?private_token=sA1cAMxP7rYqosRz7DcG"),{})},m=function(e){return i.a.get("".concat(a["a"],"/projects/").concat(e.projectId,"/merge_requests?search=").concat(e.search,"&state=opened&private_token=RfRyfGXCnwJF62boNdKg"))}},"28a5":function(e,t,r){"use strict";var n=r("aae3"),i=r("cb7c"),a=r("ebd6"),s=r("0390"),c=r("9def"),o=r("5f1b"),u=r("520a"),l=Math.min,f=[].push,h="split",p="length",m="lastIndex",d=!!function(){try{return new RegExp("x","y")}catch(e){}}();r("214f")("split",2,function(e,t,r,b){var v=r;return"c"=="abbc"[h](/(b)*/)[1]||4!="test"[h](/(?:)/,-1)[p]||2!="ab"[h](/(?:ab)*/)[p]||4!="."[h](/(.?)(.?)/)[p]||"."[h](/()()/)[p]>1||""[h](/.?/)[p]?v=function(e,t){var i=String(this);if(void 0===e&&0===t)return[];if(!n(e))return r.call(i,e,t);var a,s,c,o=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,d=void 0===t?4294967295:t>>>0,b=new RegExp(e.source,l+"g");while(a=u.call(b,i)){if(s=b[m],s>h&&(o.push(i.slice(h,a.index)),a[p]>1&&a.index<i[p]&&f.apply(o,a.slice(1)),c=a[0][p],h=s,o[p]>=d))break;b[m]===a.index&&b[m]++}return h===i[p]?!c&&b.test("")||o.push(""):o.push(i.slice(h)),o[p]>d?o.slice(0,d):o}:"0"[h](void 0,0)[p]&&(v=function(e,t){return void 0===e&&0===t?[]:r.call(this,e,t)}),[function(r,n){var i=e(this),a=void 0==r?void 0:r[t];return void 0!==a?a.call(r,i,n):v.call(String(i),r,n)},function(e,t){var n=b(v,e,this,t,v!==r);if(n.done)return n.value;var u=i(e),f=String(this),h=a(u,RegExp),p=u.unicode,m=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(d?"y":"g"),g=new h(d?u:"^(?:"+u.source+")",m),x=void 0===t?4294967295:t>>>0;if(0===x)return[];if(0===f.length)return null===o(g,f)?[f]:[];var j=0,k=0,_=[];while(k<f.length){g.lastIndex=d?k:0;var N,w=o(g,d?f:f.slice(k));if(null===w||(N=l(c(g.lastIndex+(d?0:k)),f.length))===j)k=s(f,k,p);else{if(_.push(f.slice(j,k)),_.length===x)return _;for(var y=1;y<=w.length-1;y++)if(_.push(w[y]),_.length===x)return _;k=j=N}}return _.push(f.slice(j)),_}]})},"2c1c":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"step-wrap"},["0"===this.form.isPublish?r("el-steps",{attrs:{space:200,active:e.active,"finish-status":"success","align-center":""}},[r("el-step",{attrs:{title:"创建MR"}}),r("el-step",{attrs:{title:"合并代码"}}),r("el-step",{attrs:{title:"打测试tag"}})],1):r("el-steps",{attrs:{space:200,active:e.active,"finish-status":"success","align-center":""}},[r("el-step",{attrs:{title:"合并master"}}),r("el-step",{attrs:{title:"创建MR"}}),r("el-step",{attrs:{title:"合并代码"}}),r("el-step",{attrs:{title:"打测试tag"}})],1)],1),r("div",{staticClass:"form-wrap"},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"工程",prop:"project"}},[r("el-select",{model:{value:e.form.project,callback:function(t){e.$set(e.form,"project",t)},expression:"form.project"}},e._l(e.projectsOptions,function(e){return r("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})}),1)],1),r("el-form-item",{attrs:{label:"版本号",prop:"version"}},[r("el-select",{model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}},e._l(e.branchsOptions,function(e){return r("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})}),1)],1),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{disabled:!0},model:{value:e.textName,callback:function(t){e.textName=t},expression:"textName"}})],1),r("el-form-item",{attrs:{label:"有版本发布",prop:"isPublish"}},[r("el-radio",{attrs:{label:"1"},model:{value:e.form.isPublish,callback:function(t){e.$set(e.form,"isPublish",t)},expression:"form.isPublish"}},[e._v("是")]),r("el-radio",{attrs:{label:"0"},model:{value:e.form.isPublish,callback:function(t){e.$set(e.form,"isPublish",t)},expression:"form.isPublish"}},[e._v("否")])],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.onPubilshTest}},[e._v("打包测试版")]),"1"===this.form.isPublish?r("el-button",{attrs:{disabled:""}},[e._v("打包正式版")]):r("el-button",{attrs:{type:"primary"},on:{click:e.onShowChecklist}},[e._v("打包正式版")])],1)],1),e.testBranchName?r("div",{staticStyle:{"margin-top":"20px",color:"red","font-weight":"700"}},[e._v("\n            测试分支："+e._s(e.testBranchName)+"\n        ")]):e._e(),e.publishBranchName?r("div",{staticStyle:{"margin-top":"20px",color:"red","font-weight":"700"}},[e._v("\n            正式分支："+e._s(e.publishBranchName)+"\n        ")]):e._e()],1),r("el-dialog",{attrs:{title:"发布checklist",visible:e.checklistVisible,center:""},on:{"update:visible":function(t){e.checklistVisible=t}}},[r("el-checkbox-group",{model:{value:e.checklist,callback:function(t){e.checklist=t},expression:"checklist"}},e._l(e.checklistOptions,function(t){return r("el-checkbox",{key:t.value,staticStyle:{color:"red"},attrs:{label:t.value}},[e._v(e._s(t.label))])}),1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary",loading:e.isPublishLoading},on:{click:e.onPublish}},[e._v("确 定")])],1)],1)],1)},i=[],a=(r("a481"),r("7f7f"),r("96cf"),r("1da1")),s=(r("28a5"),r("16e7")),c={name:"publish",data:function(){return{form:{version:"",project:"",isPublish:"0"},projectsOptions:[],branchsOptions:[],branchs:[],isLoading:!1,isPublishLoading:!1,active:0,rules:{project:[{required:!0,message:"此项为必填项！"}],version:[{required:!0,message:"此项为必填项！"}],isPublish:[{required:!0,message:"此项为必填项！"}]},testBranchName:"",publishBranchName:"",checklistVisible:!1,checklist:[],checklistOptions:[{label:"请求前缀配置确认（api文件夹下面，config.js文件中production配置）",value:"1"},{label:"Master分支已经合并到当前版本",value:"2"}],textName:"",textList:""}},computed:{versionNum:function(){return console.log(this.form.version.split("_")[1]),this.form.version.split("_")[1]}},watch:{"form.project":function(e){this.form.version="",this.active=0,this.testBranchName="",this.getBranchs(e)},"form.version":function(e){var t=e.split("_");t[2]?this.textName=t[2]:this.textName="备注未写请确认",this.active=0,this.testBranchName="",this.publishBranchName=""},"form.isPublish":function(e){this.active=0,this.testBranchName="",this.publishBranchName=""}},methods:{getProjects:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["g"])();case 2:t=e.sent,r=t.data,this.projectsOptions=r.map(function(e){return{label:e.name,value:e.id}});case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getBranchs:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["e"])({projectId:t});case 2:r=e.sent,n=r.data,this.branchs=n,this.branchsOptions=n.filter(function(e){return-1!==e.name.indexOf("feature")}).map(function(e){var t=e.name.split("_");return t.length<2?null:{label:t[1],value:e.name}});case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),onShowChecklist:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.checklistVisible=!0,e.checklist=[])})},onPublish:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,r,n,i,a,c,o=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.isPublishLoading=!0,this.active=0,this.publishBranchName="",e.prev=3,this.checklist.length===this.checklistOptions.length){e.next=8;break}return this.$message.error("请确认完成checklist！"),this.isPublishLoading=!1,e.abrupt("return");case 8:return e.next=10,Object(s["h"])({projectId:this.form.project});case 10:if(t=e.sent,r=t.data,n=this.maxHotfixTag(r),0!==n){e.next=18;break}return this.$message.error("尚未发布过测试版！请在测试版确认通过后发布！"),this.isPublishLoading=!1,this.checklistVisible=!1,e.abrupt("return");case 18:return i=this.versionNum.lastIndexOf("."),i=-1!==i?i:this.versionNum.length,a=r.filter(function(e){return 0===e.name.indexOf(o.versionNum.substring(0,i))}).map(function(e){return e.name.substring(i+1)}),c=-1,a.length>0&&(c=Math.max.apply(Math,a)),e.next=25,Object(s["d"])({projectId:this.form.project,tag_name:this.versionNum.substring(0,i)+"."+(1*c+1),ref:"hotfix_"+this.versionNum+"_"+n});case 25:this.publishBranchName=this.versionNum.substring(0,i)+"."+(1*c+1),this.isPublishLoading=!1,this.checklistVisible=!1,e.next=33;break;case 30:e.prev=30,e.t0=e["catch"](3),this.isPublishLoading=!1;case 33:case"end":return e.stop()}},e,this,[[3,30]])}));function t(){return e.apply(this,arguments)}return t}(),onPubilshTest:function(){var e=this;this.isLoading=!0,this.active=0,this.testBranchName="",this.$refs.form.validate(function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(r){var n,i,a,c,o,u,l,f,h,p,m,d;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=73;break}if(t.prev=1,"1"!==e.form.isPublish){t.next=15;break}return t.next=5,Object(s["c"])({projectId:e.form.project,source_branch:"master",target_branch:e.form.version,title:"merge request from master",description:"merge from master to ".concat(e.form.version)});case 5:if(n=t.sent,i=n.data,!i.changes_count){t.next=12;break}return t.next=10,Object(s["a"])({projectId:e.form.project,mrId:i.iid});case 10:t.next=14;break;case 12:return t.next=14,Object(s["b"])({projectId:e.form.project,mrId:i.iid});case 14:e.active++;case 15:if(a=e.branchs.filter(function(t){return 0===t.name.indexOf("development_"+e.versionNum)}),!(a.length>1)){t.next=21;break}e.$message.error("匹配的development分支过多："+a.length),e.isLoading=!1,t.next=66;break;case 21:if(0!==a.length){t.next=26;break}e.$message.error("没有找到对应的development分支！"),e.isLoading=!1,t.next=66;break;case 26:return t.next=28,Object(s["f"])({projectId:e.form.project,search:e.versionNum});case 28:if(c=t.sent,o=c.data,u="",!(o.length<=0)){t.next=46;break}return t.next=34,Object(s["c"])({projectId:e.form.project,source_branch:e.form.version,target_branch:a[0].name,title:"merge request "+e.versionNum,description:"merge from ".concat(e.form.version," to ").concat(a[0].name)});case 34:if(l=t.sent,f=l.data,u=f.iid,f.changes_count){t.next=43;break}return e.$message.warning("当前分支没有更新！"),t.next=41,Object(s["b"])({projectId:e.form.project,mrId:f.iid});case 41:return e.isLoading=!1,t.abrupt("return");case 43:e.active++,t.next=48;break;case 46:u=o[0].iid,e.active++;case 48:return t.next=50,Object(s["a"])({projectId:e.form.project,mrId:u});case 50:return e.active++,t.next=53,Object(s["h"])({projectId:e.form.project});case 53:return h=t.sent,p=h.data,m=e.maxHotfixTag(p),t.next=58,Object(s["d"])({projectId:e.form.project,tag_name:"hotfix_"+e.versionNum+"_"+(1*m+1),ref:a[0].name});case 58:if(e.active++,e.isLoading=!1,e.testBranchName="hotfix_"+e.versionNum+"_"+(1*m+1),!(m-1>0)){t.next=66;break}if(d=p.filter(function(t){return t.name==="hotfix_"+e.versionNum+"_"+(m-1)}),!(d.length>0)){t.next=66;break}return t.next=66,Object(s["i"])({projectId:e.form.project,tagName:"hotfix_"+e.versionNum+"_"+(m-1)});case 66:t.next=71;break;case 68:t.prev=68,t.t0=t["catch"](1),e.isLoading=!1;case 71:t.next=74;break;case 73:e.isLoading=!1;case 74:case"end":return t.stop()}},t,this,[[1,68]])}));return function(e){return t.apply(this,arguments)}}())},maxHotfixTag:function(e){var t=this,r=e.filter(function(e){return-1!==e.name.indexOf("hotfix_"+t.versionNum)}).map(function(e){return e.name.replace("hotfix_"+t.versionNum+"_","")}),n=0;return r.length>0&&(n=Math.max.apply(Math,r)),n}},mounted:function(){this.getProjects()}},o=c,u=(r("9014"),r("2877")),l=Object(u["a"])(o,n,i,!1,null,"7f839bd1",null);l.options.__file="Publish.vue";t["default"]=l.exports},"386d":function(e,t,r){"use strict";var n=r("cb7c"),i=r("83a1"),a=r("5f1b");r("214f")("search",1,function(e,t,r,s){return[function(r){var n=e(this),i=void 0==r?void 0:r[t];return void 0!==i?i.call(r,n):new RegExp(r)[t](String(n))},function(e){var t=s(r,e,this);if(t.done)return t.value;var c=n(e),o=String(this),u=c.lastIndex;i(u,0)||(c.lastIndex=0);var l=a(c,o);return i(c.lastIndex,u)||(c.lastIndex=u),null===l?-1:l.index}]})},"7f7f":function(e,t,r){var n=r("86cc").f,i=Function.prototype,a=/^\s*function ([^ (]*)/,s="name";s in i||r("9e1e")&&n(i,s,{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},"83a1":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},9014:function(e,t,r){"use strict";var n=r("b926"),i=r.n(n);i.a},b926:function(e,t,r){}}]);
//# sourceMappingURL=chunk-02730f6e.efcbb03b.js.map